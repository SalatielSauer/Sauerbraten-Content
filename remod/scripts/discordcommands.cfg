// send server commands from discord, by Salatiel

discord_command = [
	pname = (getname $arg1)
	commandprefixo = "$"
	pscommand = (strstr $arg2 (concatword "> " $commandprefixo)) //<playername> $commandprefixo
	commandsy = (substr $arg2 (+ $pscommand 2) 1)

	//ircsay $pscommand
	//ircsay $commandsy

	if (=s $commandsy $commandprefixo)[
		commandstart = (strstr $arg2 $commandprefixo)
		thecommand = (substr $arg2 (+ $commandstart 1) 100)
		//ircsay (concat $thecommand "executado")
		discordcommand $thecommand
	][]

]
delhandler irc_onmsg discord_command
addhandler irc_onmsg discord_command

discordcommand = [
	//SERVERHELP
	if (=s $arg1 "serverhelp")[
		ircsay ":blue_book: Commands: **$whois** | **$currentinfo** | **$scoreboard**"
	]

	//whois
	if (=s $arg1 "whois")[
		exec "scripts/modules/discord-country.cfg"
		all = (allplayers)
		if (= (numclients) 0)[ircsay "no players connected"]
		looplist cn $all [
			pnums = (+ $pnums 1)
			ircsay (format "**%1**(%2) %3" (getname $cn) $cn (getvar $cn "countryab"))
		]
	]

	//currentinfo
	if (=s $arg1 "currentinfo")[
		ircsay (format "Map: **%1** | Mode: **%2** | Players: **%3**/%4" (getmap) (modetostr (getmode)) (numclients) $maxclients)
	]

	//scoreboard
	if (=s $arg1 "scoreboard")[
		if (=s $currentmapname "")[currentmapname = "newmap"][currentmapname = (getmap)]
		all = (allplayers)
		if (= (numclients) 0)[ircsay "no players connected"]
		ircsay (format "**%1** [%2] (%3/%4)" $currentmapname (modetostr (getmode)) (numclients) $maxclients)
		looplist cn $all [
			if (= (getfrags $cn) 0)[pfrags = "0"][pfrags = (getfrags $cn)]
			if (= (getdeaths $cn) 0)[pdeaths = "0"][pfrags = (getdeaths $cn)]
			if (= (getflags $cn) 0)[pflags = "0"][pflags = (getflags $cn)]
			if (=s (getteam $cn) "")[pteam = "none"][pteam = (getteam $cn)]
			if (isspectator $cn)[pstate = "spectator"][if (isediting $cn)[pstate = "editing"][pstate = "playing"]]

			ircsay (format "- **%1** - [ **frags**: %2 | **deaths**: %3 | **scores**: %4 | **accuracy**: %5%% | **team**: %6 | **state**: %7 ]" (getname $cn) $pfrags $pdeaths $pflags (getaccuracy $cn) $pteam $pstate)
		]
	]
]
